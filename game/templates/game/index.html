<!DOCTYPE html>
<html>
<head>
    <title>Tic Tac Toe</title>
    <style>
        #game-board {
            display: grid;
            grid-template-columns: repeat(3, 50px);
            grid-template-rows: repeat(3, 50px);
            gap: 5px;
        }
        .cell {
            width: 50px;
            height: 50px;
            font-size: 24px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Tic Tac Toe</h1>
    <form id="create-game-form">
        <button type="submit">Start New Game</button>
    </form>
    <div id="game-board"></div>
    <script>
        let currentGameId = null;
        let currentPlayer = 'X'; // Inicia con el jugador X

        document.getElementById('create-game-form').onsubmit = function(event) {
            event.preventDefault();
            fetch('/game/create/', {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => {
                currentGameId = data.game_id;
                currentPlayer = 'X'; // Reiniciar al jugador X en un nuevo juego
                loadGame(currentGameId);
            });
        };

        function loadGame(game_id) {
            fetch('/game/status/' + game_id + '/')
            .then(response => response.json())
            .then(data => {
                renderBoard(data.board);
            });
        }

        function renderBoard(board) {
            let boardDiv = document.getElementById('game-board');
            boardDiv.innerHTML = '';
            for (let i = 0; i < board.length; i++) {
                let cell = document.createElement('button');
                cell.classList.add('cell');
                cell.innerText = board[i] === ' ' ? '_' : board[i];
                cell.disabled = board[i] !== ' '; // Deshabilitar celdas ya ocupadas
                cell.onclick = function() {
                    makeMove(i);
                };
                boardDiv.appendChild(cell);
            }
        }

        function makeMove(position) {
            fetch('/game/move/' + currentGameId + '/', {
                method: 'POST',
                body: JSON.stringify({position: position, player: currentPlayer}),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                renderBoard(data.board);
                if (data.winner) {
                    alert('Player ' + data.winner + ' wins!');
                } else if (data.game_over) {
                    alert('Game Over! It\'s a tie.');
                } else {
                    currentPlayer = data.current_turn; // Cambiar al siguiente turno
                }
            });
        }
    </script>
</body>
</html>
